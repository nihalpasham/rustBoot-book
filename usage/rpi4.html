<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rpi4 - rustBoot Documentation</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Objectives</li><li class="chapter-item expanded "><a href="../objectives.html"><strong aria-hidden="true">1.</strong> Goals</a></li><li class="chapter-item expanded "><a href="../features.html"><strong aria-hidden="true">2.</strong> Features</a></li><li class="chapter-item expanded affix "><li class="part-title">Design and Architecture Overview</li><li class="chapter-item expanded "><a href="../design.html"><strong aria-hidden="true">3.</strong> Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../design/core_components.html"><strong aria-hidden="true">3.1.</strong> Components of rustBoot</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../arch/images.html"><strong aria-hidden="true">4.1.</strong> rustBoot Images</a></li><li class="chapter-item expanded "><a href="../arch/partitions.html"><strong aria-hidden="true">4.2.</strong> rustBoot Partitions</a></li><li class="chapter-item expanded "><a href="../arch/secure_boot_update.html"><strong aria-hidden="true">4.3.</strong> Secure-Boot & Update</a></li><li class="chapter-item expanded "><a href="../arch/signing_utilities.html"><strong aria-hidden="true">4.4.</strong> Signing Utilities</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="../user_guide.html"><strong aria-hidden="true">5.</strong> Build & Flash</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../usage/nrf52840.html"><strong aria-hidden="true">5.1.</strong> nrf52840</a></li><li class="chapter-item expanded "><a href="../usage/rp2040.html"><strong aria-hidden="true">5.2.</strong> rp2040</a></li><li class="chapter-item expanded "><a href="../usage/rpi4.html" class="active"><strong aria-hidden="true">5.3.</strong> rpi4</a></li><li class="chapter-item expanded "><a href="../usage/stm32f411.html"><strong aria-hidden="true">5.4.</strong> stm32f411</a></li><li class="chapter-item expanded "><a href="../usage/stm32f446.html"><strong aria-hidden="true">5.5.</strong> stm32f446</a></li><li class="chapter-item expanded "><a href="../usage/stm32f469.html"><strong aria-hidden="true">5.6.</strong> stm32f469</a></li><li class="chapter-item expanded "><a href="../usage/stm32h723.html"><strong aria-hidden="true">5.7.</strong> stm32h723</a></li><li class="chapter-item expanded "><a href="../usage/stm32f746.html"><strong aria-hidden="true">5.8.</strong> stm32f746</a></li><li class="chapter-item expanded "><a href="../usage/stm32f334.html"><strong aria-hidden="true">5.9.</strong> stm32f334</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Coding Guidelines and Testing</li><li class="chapter-item expanded "><a href="../coding_guide.html"><strong aria-hidden="true">6.</strong> Coding guidelines</a></li><li class="chapter-item expanded "><a href="../testing.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li class="chapter-item expanded affix "><li class="part-title">Continuous Integration</li><li class="chapter-item expanded "><a href="../continuous-integration.html"><strong aria-hidden="true">8.</strong> Continuous Integration</a></li><li class="chapter-item expanded affix "><li class="part-title">For Developers</li><li class="chapter-item expanded "><a href="../for_developers/index.html"><strong aria-hidden="true">9.</strong> For Developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../for_developers/ref_guide.html"><strong aria-hidden="true">9.1.</strong> Reference Guide</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../misc/contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">rustBoot Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nihalpasham/rustBoot-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="raspberry-pi-4"><a class="header" href="#raspberry-pi-4"><code>raspberry-pi 4</code></a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents"><code>Table of contents:</code></a></h2>
<ul>
<li>  <a href="./rpi4.html#---raspberry-pi-4-boot-sequence"><code>raspberry-pi 4 boot-sequence:</code></a>   🥧 </li>
<li>  <a href="./rpi4.html#---rustboot-execution-sequence"><code>rustBoot execution-sequence:</code></a>   🦀 </li>
<li>  <a href="./rpi4.html#---booting-from-an-sd-card"><code>Booting from an SD card:</code></a>   💾</li>
<li>  <a href="./rpi4.html#---compiling-rustboot"><code>Compiling rustBoot:</code></a>   ⌛</li>
<li>  <a href="./rpi4.html#---adding-a-root-file-system"><code>Adding a root file system:</code></a>   💼</li>
<li>  <a href="./rpi4.html#---uart-communication"><code>UART communication:</code></a>   🚌</li>
<li>  <a href="./rpi4.html#---power-on-and-test"><code>Power-on and test:</code></a>   🧪</li>
</ul>
<h3 id="---raspberry-pi-4-boot-sequence"><a class="header" href="#---raspberry-pi-4-boot-sequence">🥧   raspberry-pi 4 boot-sequence:</a></h3>
<p>rpi4 has an unconventional boot process</p>
<ul>
<li>Upon initial power-on, the <code>bcm2711</code> SoC (CPU is offline but GPU is powered on) executes from the onboard bootROM i.e. <code>1st stage bootloader</code> </li>
</ul>
<blockquote>
<p>Note: the GPU contains a tiny risc core that executes the <code>bootROM</code>. </p>
</blockquote>
<ul>
<li><code>bootROM</code> checks an onboard SPI-EEPROM for a 2nd stage bootloader</li>
<li>This <code>2nd stage bootloader</code> is loaded into the GPU's L2 cache for the GPU to execute. 
<ul>
<li>It initializes system clocks and SDRAM</li>
<li>loads GPU firmware (start4.elf) into RAM</li>
</ul>
</li>
<li>the <code>GPU firmware</code> performs RAM allocations i.e. 
<ul>
<li>RAM is shared between CPU and GPU </li>
<li>enables BCM7211 CPU.</li>
<li>loads <code>rustBoot-bootloader</code> from the SD card into CPU-assigned RAM and passes control of the ARMv8 core to rustBoot</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: At this point, rustBoot has complete control over the CPU. </p>
</blockquote>
<h3 id="---rustboot-execution-sequence"><a class="header" href="#---rustboot-execution-sequence">🦀   rustBoot execution-sequence:</a></h3>
<ul>
<li>By default, rpi4 will always start executing in EL2. Since we are booting a traditional Kernel (i.e. linux), we have to transition into the more appropriate EL1.</li>
</ul>
<blockquote>
<p>Note: EL1 and EL2 are abbreviations for ARMv8-A exception levels</p>
</blockquote>
<p>So, rustBoot checks the following</p>
<ul>
<li>is the core executing in <code>EL2</code>? </li>
<li>are we executing on the <code>boot-core</code> i.e. is it core 0? </li>
<li>if the answer to any of the above questions is <code>no</code>, then we park the core i.e. go into an infinite wait state.</li>
<li>If yes, then we initialize <code>DRAM</code>, <code>zero out bss</code>, transition to EL1 and finally jump to an early initialization routine called kernel_init.</li>
<li><code>kernel_init</code> is an early initialization routine. It takes care of the following - 
<ul>
<li>enables exception handling</li>
<li>enables the MMU along with instruction + data caching</li>
<li>initializes a small set of peripheral drivers i.e EMMC controller, UART, GPIO</li>
<li>and passes control to the core bootloader routine called kernel_main.</li>
</ul>
</li>
<li><code>kernel_main</code> takes care of loading, verifying and booting fit-images.
<ul>
<li>it uses rustBoot's (fat32) file-system to retrieve the first partition (or volume). </li>
</ul>
<blockquote>
<p>Note:  rustBoot does not support GUID Partition Table disks.</p>
</blockquote>
<ul>
<li>If the first volume is a <code>valid fat32</code> partition, it loads the supplied fit-image into RAM and attempts to verify its signature using the ecdsa algorithm.</li>
<li>If the fit-image is authentic i.e. the signature check passes, it relocates the following components to an appropriate location in memory. 
<ul>
<li><code>linux kernel</code></li>
<li><code>fdt or dtb</code></li>
<li><code>ramdisk or initramfs</code></li>
</ul>
</li>
<li>additionally, it will patch the dtb with any supplied (boot-time) kernel command-line arguments. </li>
</ul>
<blockquote>
<p>Note: kernel cmd-line arguments are set at package-build time i.e. when building the fit-image and cannot be interactively set at run time.</p>
</blockquote>
<ul>
<li>Finally, it disables the MMU and boots the linux kernel by jumping to its (relocated) entry point.</li>
</ul>
</li>
</ul>
<h3 id="---booting-from-an-sd-card"><a class="header" href="#---booting-from-an-sd-card">💾   Booting from an SD card:</a></h3>
<p>Raspberry Pi computers use a micro SD card to store a bootable image.</p>
<p><em>SD card preparation:</em> </p>
<ul>
<li>make 2 partitions 
<ul>
<li>the first one must be a <code>fat32</code> partition named <code>firmware</code>. The <code>fat</code> partition needs to be (at-least) 150MB(s). But to keep things simple, you can use a 256MB partition.</li>
<li>the second one can be <code>ext2/3/4</code> partition. This is used to host the root file system. </li>
</ul>
</li>
</ul>
<p><em>FAT32 partition contents:</em></p>
<ul>
<li>Create a file named <code>config.txt</code> with the following contents in the fat partition.</li>
</ul>
<pre><code>    arm_64bit=1
    enable_uart=1
    init_uart_clock=4000000
    kernel=rustBoot.bin
</code></pre>
<ul>
<li>Copy the following files from the Raspberry Pi firmware repo onto the fat partition:
<ul>
<li><a href="https://github.com/raspberrypi/firmware/raw/master/boot/fixup4.dat">fixup4.dat</a></li>
<li><a href="https://github.com/raspberrypi/firmware/raw/master/boot/start4.elf">start4.elf</a></li>
<li><a href="https://github.com/raspberrypi/firmware/raw/master/boot/bcm2711-rpi-4-b.dtb">bcm2711-rpi-4-b.dtb</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: Should it not work on your rpi4, try renaming start4.elf to start.elf (without the 4) on the SD card.</p>
</blockquote>
<h3 id="---compiling-rustboot"><a class="header" href="#---compiling-rustboot">⌛   <code>Compiling rustBoot:</code></a></h3>
<p>You must have rust installed. You can install rust by following the installation instructions <a href="https://www.rust-lang.org/tools/install">here</a>. After installing rust, you'll need to switch to rust's <code>nightly</code> toolchain and add the <code>aarch64</code> compilation-target. This will allow us to compile code for the rpi4 </p>
<pre><code class="language-powershell">rustup default nightly
rustup target add aarch64-unknown-none-softfloat
</code></pre>
<p>Additionally you'll need a few binary utilities to extract the bootloader as a <code>.bin</code> file. They can be installed via the following commands.</p>
<pre><code class="language-powershell">cargo install cargo-binutils
rustup component add llvm-tools-preview
</code></pre>
<p>To verify that you have the pre-requisites installed correctly, run the following command</p>
<pre><code class="language-powershell">rustup show
</code></pre>
<p>In my case, <code>rustup show</code> returns the following output. </p>
<pre><code class="language-powershell">rustup show
Default host: aarch64-apple-darwin
rustup home:  /Users/nihal.pasham/.rustup

installed toolchains
--------------------

stable-aarch64-apple-darwin
nightly-aarch64-apple-darwin (default)

installed targets for active toolchain
--------------------------------------

aarch64-apple-darwin
aarch64-unknown-none-softfloat
thumbv7em-none-eabihf

active toolchain
----------------

nightly-aarch64-apple-darwin (default)
rustc 1.63.0-nightly (ee160f2f5 2022-05-23)
</code></pre>
<p>You should be able to see <code>aarch64-unknown-none-softfloat</code> as one of the installed targets. To compile the rustBoot-bootloader, simply clone the <a href="https://github.com/nihalpasham/rustBoot"><code>rustBoot repo</code></a> and run the following command</p>
<pre><code class="language-powershell">cargo rpi4 build rustBoot-only
</code></pre>
<p>The above command should output the following (output will be longer when compiling for the first time) logs, produce an executable bootloader named <code>rustBoot.bin</code> and store it in the following path <code>./rustBoot/boards/bootloaders/rpi4</code></p>
<pre><code class="language-powershell">Output:
   Compiling xtask v0.1.0 (/Users/nihal.pasham/devspace/rust/projects/prod/rustBoot/xtask)
    Finished dev [unoptimized + debuginfo] target(s) in 0.64s
     Running `target/debug/xtask rpi4 build rustBoot-only`
$ cargo build --release
   Compiling rustBoot v0.1.0 (/Users/nihal.pasham/devspace/rust/projects/prod/rustBoot/rustBoot)
   Compiling rustBoot-hal v0.1.0 (/Users/nihal.pasham/devspace/rust/projects/prod/rustBoot/boards/hal)
   Compiling rpi4 v0.1.0 (/Users/nihal.pasham/devspace/rust/projects/prod/rustBoot/boards/bootloaders/rpi4)
    Finished release [optimized] target(s) in 4.77s
$ rust-objcopy --strip-all -O binary ../../target/aarch64-unknown-none-softfloat/release/kernel rustBoot.bin
</code></pre>
<blockquote>
<p>If you run into any linker issues during the compilation process in a windows environment, please ensure you have C++ build tools installed on your machine. You can download and install the visual studio's build tools from the <a href="https://docs.microsoft.com/en-us/windows/dev-environment/rust/setup">microsoft website</a>.</p>
</blockquote>
<p>After compiling rustBoot, copy <code>rustBoot.bin</code> file onto the sd card's fat32 partition.</p>
<p>The last step in preparing a bootable SD card is to copy the rustBoot fit-image that you'd like to boot onto the sd card's fat32 partition.</p>
<blockquote>
<p>Note: </p>
<ul>
<li>to build a rustBoot fit-image, you can follow <a href="../arch/images.html#building-a-rustboot-compliant-fit-image">these instructions</a> and</li>
<li>to sign a fit-image, you can follow <a href="../arch/images.html#signing-fit-images">these instructions</a>. </li>
</ul>
</blockquote>
<p>Finally, once you've added the above mentioned files to your sd card. The fat32 partition should contain the following files: </p>
<ul>
<li>  config.txt</li>
<li>  fixup4.dat</li>
<li>  start4.elf</li>
<li>  bcm2711-rpi-4-b.dtb</li>
<li>  rustBoot.bin</li>
<li>  signed-example-image.itb</li>
</ul>
<h3 id="---adding-a-root-file-system"><a class="header" href="#---adding-a-root-file-system">💼   Adding a root file system:</a></h3>
<p>There are many ways to add a root file-system to the second ext2/3/4 partition. One way is to copy a root file system to an empty ext2/3/4 drive: </p>
<ul>
<li>Maintainers of a linux distribution provide pre-built OS images. These images usually contain several partitions such as - 
<ul>
<li><code>boot:</code> contains the bootloader, kernel, dtb, ramdisk and other stuff</li>
<li><code>system:</code> contains the root file system </li>
<li><code>others:</code> may contain other partitions for things such as storage etc.</li>
</ul>
</li>
<li>simply download an OS image or a pre-built linux distribution from the maintainers website.
<ul>
<li>in this example, I'll be using the <a href="https://www.apertis.org/download/"><code>apertis</code></a> distribution.</li>
</ul>
</li>
<li>it’s usually in a compressed (zImage) format, decompress it using a tool like unarchiver to get a disk image.</li>
<li>use <code>partx --show</code> to list all partitions</li>
</ul>
<pre><code class="language-powershell">$ partx --show __linux_image_filepath__
NR  START     END SECTORS SIZE NAME UUID
 1   8192  532479  524288 256M      9730496b-01
 2 532480 3661823 3129344 1.5G      9730496b-02
</code></pre>
<ul>
<li>in the above example, partition 2 with a size of 1.5G contains the root file system. It's usually named <code>system</code>.</li>
<li>calculate the offset to the <code>system</code> volume/partition. You can do this with the <code>bc</code> command. </li>
</ul>
<blockquote>
<p><code>512</code> is the sector-size. We multiply sector-size with the sector offset to get the actual starting (byte) location of <code>system</code>.</p>
</blockquote>
<pre><code class="language-powershell">$ bc
bc 1.07.1
Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006, 2008, 2012-2017 Free Software Foundation, Inc.
This is free software with ABSOLUTELY NO WARRANTY.
For details type `warranty'.
&gt; 532480 * 512
&gt; 272629760
&gt; quit
</code></pre>
<ul>
<li>mount the partition as an <code>ext4 filesystem</code> </li>
</ul>
<pre><code>$ sudo mkdir /mnt/other
$ sudo mount -v -o offset=272629760 -t ext4 /_path_to_file_image/__filename__.img /mnt/other
mount: /dev/loop0 mounted on /mnt/other.

Check mounted image

$ ls /mnt/other
</code></pre>
<ul>
<li>copy all of (system partition's) contents to sd card's ext2/3/4 partition using the <code>cp</code> command. </li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li>this method only works on linux or macOS and does not work on WSL2.</li>
<li>all symbolic links need to be copied. If required you can create symbolic links using <code>ln</code> command. Here' an example that creates a symbolic link called <code>sbin</code> to <code>usr/bin</code> </li>
</ul>
<pre><code class="language-powershell">ln -s usr/sbin sbin 
</code></pre>
</blockquote>
<h3 id="---uart-communication"><a class="header" href="#---uart-communication">🚌   UART communication:</a></h3>
<p>rustBoot will output boot-logs via the raspberry-pi 4's UART interface. These logs can be sent to a host computer (i.e. laptop/desktop).</p>
<p>We'll need extra hardware for this:</p>
<ul>
<li><strong>a usb-to-serial ttl converter:</strong> is a tiny piece of hardware that allows us to send serial data from the rpi4's uart interface to the host
<ul>
<li>You can find USB-to-serial cables that should work right away at <a href="https://www.amazon.de/dp/B0757FQ5CX/ref=cm_sw_r_tw_dp_U_x_ozGRDbVTJAG4Q">[1]</a> <a href="https://www.adafruit.com/product/954">[2]</a>, but many others will work too. Ideally, your cable is based on the CP2102 chip.</li>
<li>You connect it to GND and GPIO pins 14/15 as shown below.</li>
</ul>
</li>
</ul>
<p>Connect the USB-serial converter to your host computer as shown in the wiring diagram
<a href="https://github.com/imrank03/rustBoot-book-diagrams/blob/main/USB-serial.png?raw=true"><img src="https://github.com/imrank03/rustBoot-book-diagrams/blob/main/USB-serial.png?raw=true" alt="wiring diagram" title="USB-Serial UART connection" /></a>.</p>
<ul>
<li>make sure that you DO NOT connect the power pin of the USB serial. Only RX/TX and GND.</li>
<li>connect the rpi4 to the (USB) power cable and observe the output:</li>
</ul>
<p><strong>Serial console:</strong>
To view rpi4's output on a host machine, you'll need a tool/app/console that handles sending and receiving of serial data. There are a number of ways to interact with a serial console. I'll be using </p>
<ul>
<li><code>minicom</code> on linux</li>
<li><code>screen</code> on the mac</li>
<li><code>terminal-s</code> on windows</li>
</ul>
<blockquote>
<p>❗ NOTE: 
Depending on your host operating system, the device name might differ. For example, on macOS, it might be something like /dev/tty.usbserial-0001. In this case, please give the name explicitly:</p>
</blockquote>
<ul>
<li><strong>Using minicom:</strong>
<ul>
<li>install minicom with <code>sudo apt-get install minicom</code>, so you can emulate a terminal connected over serial.</li>
<li>and run </li>
</ul>
<pre><code class="language-powershell">minicom -b 115200 -D /dev/tty.usbserial-0001
</code></pre>
<ul>
<li>boot the Pi.</li>
<li>within a few seconds, you should see data in your session.</li>
</ul>
</li>
<li><strong>Using screen:</strong>
<ul>
<li>on a mac, run </li>
</ul>
<pre><code class="language-powershell">screen /dev/tty.usbserial-0001 115200
</code></pre>
<ul>
<li>boot the Pi.</li>
<li>within a few seconds, you should see data in your session.</li>
</ul>
</li>
<li><strong>Using terminal-s:</strong>
<ul>
<li>on a windows machine, install terminal-s (a python-based serial terminal) with <code>pip install terminal-s</code></li>
<li>and run </li>
</ul>
<pre><code class="language-powershell">terminal-s
</code></pre>
<ul>
<li>no need to provide a baud-rate. It will auto-detect the port and baud-rate (assuming its lower than 115200).</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: </p>
<ul>
<li>To exit the screen session, press Ctrl-A, then Ctrl-K, and confirm you want to exit when using minicom or screen</li>
<li>To exit terminal-s, press Ctrl-]</li>
</ul>
</blockquote>
<h3 id="---power-on-and-test"><a class="header" href="#---power-on-and-test">🧪   Power-on and test:</a></h3>
<p>Now that you have a fully bootable SD card containing</p>
<ul>
<li>a <code>fat32 formatted</code> boot partition populated with the relevant boot files and</li>
<li>a <code>ext2/3/4 formatted</code> root-file-system</li>
</ul>
<p>and have your uart-usb interface set-up, you are now ready to flip the switch i.e. </p>
<ul>
<li>insert the sd card into the pi's sd slot and</li>
<li>supply power to your pi. </li>
</ul>
<p>Your serial console should now start <a href="https://github.com/nihalpasham/rustBoot/blob/main/boards/bootloaders/rpi4/debug.md">receiving boot-logs from the rpi4</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../usage/rp2040.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../usage/stm32f411.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../usage/rp2040.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../usage/stm32f411.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
